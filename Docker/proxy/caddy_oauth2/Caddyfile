# With the DNS-Name provided Caddy automatically tries to provide a certification via LetsEncrypt, so make sure your Loadbalancer has the same FloatingIP then the corresponding DNS-Entry you are using in the following config
<YOUR_DNS_ENTRY> {
    # This block configures the caddy-security app and its plugins.
    security {
        # Define GitHub as the sole identity provider.
        oauth identity provider github {
            client_id env.GITHUB_CLIENT_ID
            client_secret env.GITHUB_CLIENT_SECRET
        }

        # The authentication portal will only show the GitHub login option.
        authentication portal myportal {
            enable identity provider github
            path /auth
        }

        # Define the policy that allows any authenticated GitHub user.
        authorization policy github_access {
            set auth url https://<YOUR_DNS_ENTRY>/auth/oauth2/github
            # The 'match realm github' directive is sufficient.
            # It allows anyone authenticated via the GitHub provider.
            match realm github
            allow roles authp/user
        }
    }

    # Handle all requests to the "/auth" path for the login portal.
    route /auth* {
        authenticate with myportal
    }

    # All other traffic is protected by the general GitHub access policy.
    route * {
        authorize with github_access
        reverse_proxy <WEBSERVER_IP:WEBSERVER_PORT>
    }
}
